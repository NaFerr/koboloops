}
else {
return("")
}
}
aok_mode <- function(x) {
ux <- unique(x[!is.na(x)])
# This checks to see if we have more than one mode (a tie), return blank if so.
if (length(which(tabulate(match(x, ux)) == max(tabulate(match(x, ux))))) > 1) {
if (class(x) == "logical") {
return(as.logical("")) # Blanks are coerced to values in logical vectors, so we specifically identify columns with TRUE/FALSE (KoBo's select multiples) and output a "logical" blank.
}
else {
return("")
}
}
else {
ux[which.max(tabulate(match(x, ux)))] ## This occurs if no tie, so we return the value which has max value! Wambam.
}
}
AoK <- function(x) {
aok_mode(x)
}
AoK <- function(x) {
aok_mode(x)
}
aok_mode <- function(x) {
ux <- unique(x[!is.na(x)])
# This checks to see if we have more than one mode (a tie), return blank if so.
if (length(which(tabulate(match(x, ux)) == max(tabulate(match(x, ux))))) > 1) {
if (class(x) == "logical") {
return(as.logical("")) # Blanks are coerced to values in logical vectors, so we specifically identify columns with TRUE/FALSE (KoBo's select multiples) and output a "logical" blank.
}
else {
return("")
}
}
else {
ux[which.max(tabulate(match(x, ux)))] ## This occurs if no tie, so we return the value which has max value! Wambam.
}
}
aok_frequency <- function(x) {
ux <- unique(x[!is.na(x)])
# This checks to see if we have more than one mode (a tie), return blank if so.
if ("week"%in% x) {
return("week")
}
else if("two_weeks" %in% x) {
return("two_weeks")
}
else if("one_month" %in% x) {
return("one_month")
}
else if("few_months" %in% x) {
return("few_months")
}
else if("emergency" %in% x) {
return("emergency")
}
else if("asneeded" %in% x) {
return("asneeded")
}
else if("dontknow" %in% x) {
return("dontknow")
}
else {
return("")
}
}
aok_recent <- function(x) {
ux <- unique(x[!is.na(x)])
# This checks to see if we have more than one mode (a tie), return blank if so.
if ("1_month"%in% x) {
return("1_month")
}
else if ("3_months"%in% x) {
return("3_months")
}
else if("4_6_months" %in% x) {
return("4_6_months")
}
else if("7_12_months" %in% x) {
return("7_12_months")
}
else if("1_year" %in% x) {
return("1_year")
}
else if("dontknow" %in% x) {
return("dontknow")
}
else {
return("")
}
}
moveme <- function (invec, movecommand) {
movecommand <- lapply(strsplit(strsplit(movecommand, ";")[[1]],
",|\\s+"), function(x) x[x != ""])
movelist <- lapply(movecommand, function(x) {
Where <- x[which(x %in% c("before", "after", "first",
"last")):length(x)]
ToMove <- setdiff(x, Where)
list(ToMove, Where)
})
myVec <- invec
for (i in seq_along(movelist)) {
temp <- setdiff(myVec, movelist[[i]][[1]])
A <- movelist[[i]][[2]][1]
if (A %in% c("before", "after")) {
ba <- movelist[[i]][[2]][2]
if (A == "before") {
after <- match(ba, temp) - 1
}
else if (A == "after") {
after <- match(ba, temp)
}
}
else if (A == "first") {
after <- 0
}
else if (A == "last") {
after <- length(myVec)
}
myVec <- append(temp, values = movelist[[i]][[1]], after = after)
}
myVec
}
aok_yes <- function(x) {
ux <- unique(x[!is.na(x)])
# This checks to see if we have more than one mode (a tie), return blank if so.
if ("yes" %in% x) {
return("yes") # Blanks are coerced to values in logical vectors, so we specifically identify columns with TRUE/FALSE (KoBo's select multiples) and output a "logical" blank.
}
else if("no" %in% x) {
return("no")
}
else {
return("")
}
}
aok_no <- function(x) {
ux <- unique(x[!is.na(x)])
# This checks to see if we have more than one mode (a tie), return blank if so.
if ("no"%in% x) {
return("no") # Blanks are coerced to values in logical vectors, so we specifically identify columns with TRUE/FALSE (KoBo's select multiples) and output a "logical" blank.
}
else if("yes" %in% x) {
return("yes")
}
else {
return("")
}
}
d.f <- read.csv(CLEANED_DATASET, stringsAsFactors = FALSE, skipNul = TRUE, colClasses = "character")
setwd("C:/Users/GVA-DATA_UNITY/Desktop/Impact/NGA/NGA1809/New folder")
d.f <- read.csv(CLEANED_DATASET, stringsAsFactors = FALSE, skipNul = TRUE, colClasses = "character")
d.f <- dplyr::select(d.f, everything(), -contains("X_notes"))
d.f$C_info_state
settlement_yes <- d.f %>%
dplyr:: select(C_info_state, C_info_lga, C_info_ward, C_info_settlement,
D_D1_hc_now, D_D2_idp_now, D_D3_returnees_now, E_food_wild_now, E_food_distr, E_market_now, E_cereal_price_increase,
E_harvest_who, F_health_now, F_supp_feeding, F_mortality_increase, G_prot_incidence, G_prot_looting, G_prot_unaccompanied,
G_disputes_violence, G_lighting, G_night_walk, G_abduction_girls, G_abduction_boys, G_suicide_bombing, I_I2_shelter_open_yn,
I_shelter_damage, I_shelter_flooding, I_nfi_distribution, J_water_boreholes, J_water_boreholes_functional, J_water_source_animals,
J_water_safety, J_latrine_now, K_edu_now, K_edu_girl_formal, K_edu_girl_informal, K_edu_boy_formal, K_edu_boy_informal,
L_community_leadership, L_idp_leadership, M_mines, M_mine_acc_numb, N_mobilephone, N_prevent_info) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_yes))
settlement_yes <- d.f %>%
dplyr:: select(C_info_state, C_info_lga, C_info_ward, C_info_settlement,
D_D1_hc_now, D_D2_idp_now, D_D3_returnees_now, E_food_wild_now, E_food_distr, E_market_now, E_cereal_price_increase,
E_harvest_who, F_health_now, F_supp_feeding, F_mortality_increase, G_prot_incidence, G_prot_looting, G_prot_unaccompanied,
G_disputes_violence, G_lighting, G_night_walk, G_abduction_girls, G_abduction_boys, G_suicide_bombing, I_I2_shelter_open_yn,
I_shelter_damage, I_shelter_flooding, I_nfi_distribution, J_water_boreholes, J_water_boreholes_functional, J_water_source_animals,
J_water_safety, J_latrine_now, K_edu_now, K_edu_girl_formal, K_edu_girl_informal, K_edu_boy_formal, K_edu_boy_informal,
L_community_leadership, L_idp_leadership, M_mines, M_mine_acc_numb, N_mobilephone, N_prevent_info) %>%
group_by(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_yes))
settlement_yes
settlement_no <- d.f %>%
dplyr:: select(C_info_state, C_info_lga, C_info_ward,C_info_settlement,E_food_now, E_livelihoods_barriers, E_land_available, E_ag_inputs,E_livestock_possession,
E_livestock_access) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_no))
## Let us apply the "aok_mode" function to these set of columns
settlement_equal <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward,C_info_settlement, D_D1_hc_remain_perc, D_D2_idp_perc, D_D2_idp_source_state, D_D2_idp_source_lga,
D_D2_idp_source_ward, D_D4_child_perc, D_D4_pregnant_lactating_perc, E_food_no_reason1, E_food_now_type_fruit,
E_food_now_type_main_staples, E_food_now_type_meat, E_food_now_type_pulses, E_food_now_type_milk_dairy, E_food_now_type_vegetables,
E_food_source, E_meals_number, E_food_coping_consumption_borrow_food, E_food_coping_consumption_less_expensive_food,
E_food_coping_consumption_limit_meal_size, E_food_coping_consumption_wild_food, E_food_coping_consumption_only_children_eat,
E_food_coping_consumption_reduce_meals, E_food_coping_consumption_skip_days, E_food_coping_livelihoods_borrow_food,
E_food_coping_livelihoods_borrow_money, E_food_coping_livelihoods_gather_wild_food, E_food_coping_livelihoods_consume_seeds,
E_food_coping_livelihoods_send_children_to_neighbors, E_food_coping_livelihoods_household_begs, E_food_coping_livelihoods_sell_home_assets,
E_food_coping_livelihoods_sell_livestock, E_food_coping_livelihoods_slaughter_livestock, E_food_coping_livelihoods_hunting,
E_food_coping_livelihoods_cattle_camps, E_food_coping_livelihoods_fishing, E_food_coping_livelihoods_displacement_camp,
E_food_coping_livelihoods_none, E_food_coping_consumption_none, E_shock_hunger, E_shock_arrival, E_shock_cereal_price,
E_shock_protection, E_current_activities_casual_labour, E_current_activities_crops_for_cash, E_current_activities_crops_for_sustenance,
E_current_activities_livestock, E_current_activities_hunting, E_current_activities_fishing, E_current_activities_market,
E_current_activities_salaries, E_current_activities_remittances, E_current_activities_poultry, E_current_activities_none,
E_livelihoods_practice_subsistence, E_livelihoods_practice_farmingsell, E_livelihoods_practice_grazing, E_livelihoods_practice_markets,
E_livelihoods_practice_transportation, E_livelihoods_practice_trade, E_livelihoods_practice_artisan, E_livelihoods_practice_service,
E_livelihoods_barriers_choice_farmland, E_livelihoods_barriers_choice_grazing, E_livelihoods_barriers_choice_markets,
E_livelihoods_barriers_choice_transportation, E_livelihoods_barriers_choice_waterways, E_harvest_use, E_fuel_cooking, E_fuel_lighting,
E_fuel_obtain, E_fuel_tripstime, E_fuel_insufficient, F_health_dist, F_health_no_reason1, F_health_problems1, F_death_cause1,
F_mortality_increase_why, G_prot_now, G_prot_women_concern, G_prot_men_concern, G_prot_girls_concern, G_prot_boys_concern,
G_comm_relations, G_disputes, I_I1_nd_shelter_type1, I_I1_nd_location, I_I1_rt_location, I_I1_rt_shelter_type1,
I_I2_idp_location, I_I2_idp_shelter_type1, I_I2_shelter_open, I_shelter_materials_grass, I_shelter_materials_mud,
I_shelter_materials_timber, I_shelter_materials_rope, I_shelter_materials_cgi, I_shelter_materials_ps, I_shelter_materials_pole,
I_shelter_materials_none, I_shelter_destroyed_percent, I_nfi_available_blanket, I_nfi_available_sleeping_mat,
I_nfi_available_jerry_can, I_nfi_available_cooking_pot, I_nfi_available_mosquito_net, I_nfi_available_bucket, I_nfi_available_soap,
I_nfi_available_none, I_nfi_source_pre_displacement, I_nfi_source_didnt_get, I_nfi_source_market, I_nfi_source_local_community,
I_nfi_source_ngo, I_nfi_source_other, I_shelter_materials_other, I_nfi_available_other, E_current_activities_other,
E_livelihoods_barriers_choice_other, E_livelihoods_practice_other, I_nfi_need1, J_water_now_how, J_water_now_time,
J_latrine_usage, J_latrine_no_usage, J_hand_washing, K_edu_no_reason, K_edu_girl_formal_attendance, K_edu_girl_informal_attendance,
K_attendance_no_reason1_girls, K_edu_boy_formal_attendance, K_edu_boy_informal_attendance, K_attendance_no_reason1_boys,
L_community_leadership_groups_youth, L_community_leadership_groups_women, L_community_leadership_groups_elderly,
L_community_leadership_groups_disabled, L_community_leadership_groups_none, N_info_source, N_info_source_who, N_electricity,
N_mobilephone_percent, N_prevent_info_how, N_prevent_info_what, N_info_trust) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(AoK))
settlement_equal
View(settlement_yes)
View(settlement_yes)
View(settlement_no)
View(settlement_no)
View(settlement_equal)
View(settlement_equal)
## Let us apply the "aok_frequency" function to these set of columns
settlement_frequency <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward,C_info_settlement, L_leadership_meetings) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_frequency))
## Let us apply the "aok_recent" function to these set of columns
settlement_recent <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward, C_info_settlement,D_D2_idp_time_arrive,D_D3_returnee_time_arrived) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_recent))
settlement_numbers <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward, C_info_settlement, M_quantity_uxo) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement"))
settlement_numbers<- as.data.frame(settlement_numbers)
settlement_numbers$M_quantity_uxo <- as.numeric(settlement_numbers$M_quantity_uxo)
settlement_numbers$new_id <- paste(settlement_numbers$C_info_state,settlement_numbers$C_info_lga,settlement_numbers$C_info_ward,settlement_numbers$C_info_settlement,sep=".")
settlement_numbers$onesz <- 1
settlement_numbers_old <- settlement_numbers[!duplicated(settlement_numbers$new_id), ]
settlement_numbers<-settlement_numbers %>% dcast(new_id~onesz, fun.aggregate = mean,value.var="M_quantity_uxo", na.rm=TRUE)
settlement_numbers[sapply(settlement_numbers, is.nan)] <- ""
colnames(settlement_numbers)[2] <-  "M_quantity_uxo"
settlement_numbers<-merge(settlement_numbers_old,settlement_numbers,by="new_id",all.x=TRUE)
settlement_numbers[c(1,6,7)]<-NULL
colnames(settlement_numbers)[5] <-  "M_quantity_uxo"
settlement_numbers_old<-NULL
#table join. Let us merge all these columns/fields into one database
Settlement1a<-merge(settlement_yes, settlement_no, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1b<-merge(settlement_equal, settlement_recent, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1c<-merge(Settlement1a, Settlement1b, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1d<-merge(Settlement1c, settlement_numbers, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
settlement<-merge(Settlement1d, settlement_frequency, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
# #Let us rearrange the columns in our database inthe same order appear on the tool
settlement <- settlement %>%  dplyr:: select(order(match(names(settlement), names(d.f))))
settlement$D_D1_hc_remain_perc[settlement$D_D1_hc_now != "yes"] <- "SL"
settlement$D_D2_idp_perc[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_time_arrive[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_state[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_lga[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_ward[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_settlement[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D3_returnee_time_arrived[settlement$D_D3_returnees_now !="yes"]<- "SL"
settlement<-merge(Settlement1d, settlement_frequency, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
settlement_numbers <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward, C_info_settlement, M_quantity_uxo) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement"))
settlement_numbers<- as.data.frame(settlement_numbers)
settlement_numbers$M_quantity_uxo <- as.numeric(settlement_numbers$M_quantity_uxo)
settlement_numbers$new_id <- paste(settlement_numbers$C_info_state,settlement_numbers$C_info_lga,settlement_numbers$C_info_ward,settlement_numbers$C_info_settlement,sep=".")
settlement_numbers$onesz <- 1
settlement_numbers_old <- settlement_numbers[!duplicated(settlement_numbers$new_id), ]
settlement_numbers<-settlement_numbers %>% dcast(new_id~onesz, fun.aggregate = mean,value.var="M_quantity_uxo", na.rm=TRUE)
settlement_numbers[sapply(settlement_numbers, is.nan)] <- ""
colnames(settlement_numbers)[2] <-  "M_quantity_uxo"
settlement_numbers<-merge(settlement_numbers_old,settlement_numbers,by="new_id",all.x=TRUE)
settlement_numbers[c(1,6,7)]<-NULL
colnames(settlement_numbers)[5] <-  "M_quantity_uxo"
settlement_numbers_old<-NULL
#table join. Let us merge all these columns/fields into one database
Settlement1a<-merge(settlement_yes, settlement_no, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1b<-merge(settlement_equal, settlement_recent, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1c<-merge(Settlement1a, Settlement1b, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1d<-merge(Settlement1c, settlement_numbers, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
settlement<-merge(Settlement1d, settlement_frequency, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
settlement_numbers[c(1,6,7)]<-NULL
## Let us apply the "aok_mode" function to these set of columns
settlement_equal <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward,C_info_settlement, D_D1_hc_remain_perc, D_D2_idp_perc, D_D2_idp_source_state, D_D2_idp_source_lga,
D_D2_idp_source_ward, D_D4_child_perc, D_D4_pregnant_lactating_perc, E_food_no_reason1, E_food_now_type_fruit,
E_food_now_type_main_staples, E_food_now_type_meat, E_food_now_type_pulses, E_food_now_type_milk_dairy, E_food_now_type_vegetables,
E_food_source, E_meals_number, E_food_coping_consumption_borrow_food, E_food_coping_consumption_less_expensive_food,
E_food_coping_consumption_limit_meal_size, E_food_coping_consumption_wild_food, E_food_coping_consumption_only_children_eat,
E_food_coping_consumption_reduce_meals, E_food_coping_consumption_skip_days, E_food_coping_livelihoods_borrow_food,
E_food_coping_livelihoods_borrow_money, E_food_coping_livelihoods_gather_wild_food, E_food_coping_livelihoods_consume_seeds,
E_food_coping_livelihoods_send_children_to_neighbors, E_food_coping_livelihoods_household_begs, E_food_coping_livelihoods_sell_home_assets,
E_food_coping_livelihoods_sell_livestock, E_food_coping_livelihoods_slaughter_livestock, E_food_coping_livelihoods_hunting,
E_food_coping_livelihoods_cattle_camps, E_food_coping_livelihoods_fishing, E_food_coping_livelihoods_displacement_camp,
E_food_coping_livelihoods_none, E_food_coping_consumption_none, E_shock_hunger, E_shock_arrival, E_shock_cereal_price,
E_shock_protection, E_current_activities_casual_labour, E_current_activities_crops_for_cash, E_current_activities_crops_for_sustenance,
E_current_activities_livestock, E_current_activities_hunting, E_current_activities_fishing, E_current_activities_market,
E_current_activities_salaries, E_current_activities_remittances, E_current_activities_poultry, E_current_activities_none,
E_livelihoods_practice_subsistence, E_livelihoods_practice_farmingsell, E_livelihoods_practice_grazing, E_livelihoods_practice_markets,
E_livelihoods_practice_transportation, E_livelihoods_practice_trade, E_livelihoods_practice_artisan, E_livelihoods_practice_service,
E_livelihoods_barriers_choice_farmland, E_livelihoods_barriers_choice_grazing, E_livelihoods_barriers_choice_markets,
E_livelihoods_barriers_choice_transportation, E_livelihoods_barriers_choice_waterways, E_harvest_use, E_fuel_cooking, E_fuel_lighting,
E_fuel_obtain, E_fuel_tripstime, E_fuel_insufficient, F_health_dist, F_health_no_reason1, F_health_problems1, F_death_cause1,
F_mortality_increase_why, G_prot_now, G_prot_women_concern, G_prot_men_concern, G_prot_girls_concern, G_prot_boys_concern,
G_comm_relations, G_disputes, I_I1_nd_shelter_type1, I_I1_nd_location, I_I1_rt_location, I_I1_rt_shelter_type1,
I_I2_idp_location, I_I2_idp_shelter_type1, I_I2_shelter_open, I_shelter_materials_grass, I_shelter_materials_mud,
I_shelter_materials_timber, I_shelter_materials_rope, I_shelter_materials_cgi, I_shelter_materials_ps, I_shelter_materials_pole,
I_shelter_materials_none, I_shelter_destroyed_percent, I_nfi_available_blanket, I_nfi_available_sleeping_mat,
I_nfi_available_jerry_can, I_nfi_available_cooking_pot, I_nfi_available_mosquito_net, I_nfi_available_bucket, I_nfi_available_soap,
I_nfi_available_none, I_nfi_source_pre_displacement, I_nfi_source_didnt_get, I_nfi_source_market, I_nfi_source_local_community,
I_nfi_source_ngo, I_nfi_source_other, I_shelter_materials_other, I_nfi_available_other, E_current_activities_other,
E_livelihoods_barriers_choice_other, E_livelihoods_practice_other, I_nfi_need1, J_water_now_how, J_water_now_time,
J_latrine_usage, J_latrine_no_usage, J_hand_washing, K_edu_no_reason, K_edu_girl_formal_attendance, K_edu_girl_informal_attendance,
K_attendance_no_reason1_girls, K_edu_boy_formal_attendance, K_edu_boy_informal_attendance, K_attendance_no_reason1_boys,
L_community_leadership_groups_youth, L_community_leadership_groups_women, L_community_leadership_groups_elderly,
L_community_leadership_groups_disabled, L_community_leadership_groups_none, N_info_source, N_info_source_who, N_electricity,
N_mobilephone_percent, N_prevent_info_how, N_prevent_info_what, N_info_trust) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(AoK))
## Let us apply the "aok_frequency" function to these set of columns
settlement_frequency <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward,C_info_settlement, L_leadership_meetings) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_frequency))
## Let us apply the "aok_recent" function to these set of columns
settlement_recent <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward, C_info_settlement,D_D2_idp_time_arrive,D_D3_returnee_time_arrived) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>% ## .dots basically accepts the column values for the function. In this function, we are saying group by the three columns listed!
summarise_all(funs(aok_recent))
settlement_numbers <- d.f %>%
dplyr::  select(C_info_state, C_info_lga, C_info_ward, C_info_settlement, M_quantity_uxo) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement"))
settlement_numbers<- as.data.frame(settlement_numbers)
settlement_numbers$M_quantity_uxo <- as.numeric(settlement_numbers$M_quantity_uxo)
settlement_numbers$new_id <- paste(settlement_numbers$C_info_state,settlement_numbers$C_info_lga,settlement_numbers$C_info_ward,settlement_numbers$C_info_settlement,sep=".")
settlement_numbers$onesz <- 1
settlement_numbers_old <- settlement_numbers[!duplicated(settlement_numbers$new_id), ]
settlement_numbers<-settlement_numbers %>% dcast(new_id~onesz, fun.aggregate = mean,value.var="M_quantity_uxo", na.rm=TRUE)
settlement_numbers[sapply(settlement_numbers, is.nan)] <- ""
colnames(settlement_numbers)[2] <-  "M_quantity_uxo"
if (!require(dplyr)) install.packages('dplyr')
library(dplyr)
if (!require(tibble)) install.packages('tibble')
library(tibble)
settlement_numbers<-settlement_numbers %>% dcast(new_id~onesz, fun.aggregate = mean,value.var="M_quantity_uxo", na.rm=TRUE)
library(dcast)
require(data.table)
settlement_numbers<-settlement_numbers %>% dcast(new_id~onesz, fun.aggregate = mean,value.var="M_quantity_uxo", na.rm=TRUE)
settlement_numbers[sapply(settlement_numbers, is.nan)] <- ""
colnames(settlement_numbers)[2] <-  "M_quantity_uxo"
settlement_numbers<-merge(settlement_numbers_old,settlement_numbers,by="new_id",all.x=TRUE)
settlement_numbers[c(1,6,7)]<-NULL
colnames(settlement_numbers)[5] <-  "M_quantity_uxo"
settlement_numbers_old<-NULL
#table join. Let us merge all these columns/fields into one database
Settlement1a<-merge(settlement_yes, settlement_no, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1b<-merge(settlement_equal, settlement_recent, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1c<-merge(Settlement1a, Settlement1b, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
Settlement1d<-merge(Settlement1c, settlement_numbers, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
settlement<-merge(Settlement1d, settlement_frequency, by = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement") )
# #Let us rearrange the columns in our database inthe same order appear on the tool
settlement <- settlement %>%  dplyr:: select(order(match(names(settlement), names(d.f))))
settlement$D_D1_hc_remain_perc[settlement$D_D1_hc_now != "yes"] <- "SL"
ettlement$D_D2_idp_perc[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_time_arrive[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_state[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_lga[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_ward[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$D_D2_idp_source_settlement[settlement$D_D2_idp_now != "yes"] <- "SL"
#No returnees
settlement$D_D3_returnee_time_arrived[settlement$D_D3_returnees_now !="yes"]<- "SL"
## Food
settlement$E_food_no_reason1[settlement$E_food_now != "no"] <- "SL"
settlement$E_cereal_price_increase[settlement$E_market_now != "yes"] <- "SL"
settlement$E_shock_hunger[settlement$E_food_now != "no"] <- "SL"
settlement$E_shock_arrival[settlement$D_D2_idp_now != "yes" & settlement$D_D3_returnees_now != "yes"] <- "SL"
settlement$E_shock_cereal_price[settlement$E_cereal_price_increase != "yes"] <- "SL"
# Livelihoods barriers
settlement$E_livelihoods_barriers_choice_farmland[settlement$E_livelihoods_barriers != "no"] <- "SL"
settlement$E_livelihoods_barriers_choice_waterways[settlement$E_livelihoods_barriers != "no"] <- "SL"
settlement$E_livelihoods_barriers_choice_grazing[settlement$E_livelihoods_barriers != "no"] <- "SL"
settlement$E_livelihoods_barriers_choice_markets[settlement$E_livelihoods_barriers != "no"] <- "SL"
settlement$E_livelihoods_barriers_choice_transportation[settlement$E_livelihoods_barriers != "no"] <- "SL"
settlement$E_livelihoods_barriers_choice_other[settlement$E_livelihoods_barriers != "no"] <- "SL"
# Health
settlement$F_health_dist[settlement$F_health_now != "yes"] <- "SL"
settlement$F_health_no_reason1[settlement$F_health_now != "no"] <- "SL"
settlement$F_mortality_increase_why[settlement$F_mortality_increase != "yes"] <- "SL"
# Protection
settlement$G_comm_relations[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$G_disputes_violence[settlement$G_comm_relations != "neutral" & settlement$G_comm_relations != "poor"] <- "SL"
# Shelter
settlement$I_I1_nd_location[settlement$D_D1_hc_now != "yes"] <- "SL"
settlement$I_I1_nd_shelter_type1[settlement$D_D1_hc_now != "yes"] <- "SL"
settlement$I_I1_rt_location[settlement$D_D3_returnees_now != "yes"] <- "SL"
settlement$I_I1_rt_shelter_type1[settlement$D_D3_returnees_now != "yes"] <- "SL"
settlement$I_I2_idp_location[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$I_I2_idp_shelter_type1[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$I_I2_shelter_open_yn[settlement$D_D2_idp_now != "yes"] <- "SL"
settlement$I_I2_shelter_open[settlement$I_I2_shelter_open_yn != "yes"] <- "SL"
settlement$I_shelter_destroyed_percent[settlement$I_shelter_damage != "yes"] <- "SL"
# WASH
settlement$J_water_boreholes_functional[settlement$J_water_boreholes != "yes"] <- "SL"
settlement$J_latrine_usage[settlement$J_latrine_now != "yes"] <- "SL"
settlement$J_latrine_no_usage[settlement$J_latrine_usage %in% c("more_half", "dontknow", "SL")] <- "SL"
# Education
settlement$K_edu_no_reason[settlement$K_edu_now != "no"] <- "SL"
settlement$K_edu_boy_formal[settlement$K_edu_now != "yes"] <- "SL"
settlement$K_edu_boy_informal[settlement$K_edu_now != "yes"] <- "SL"
settlement$K_edu_girl_formal[settlement$K_edu_now != "yes"] <- "SL"
settlement$K_edu_girl_informal[settlement$K_edu_now != "yes"] <- "SL"
settlement$K_edu_boy_formal_attendance[settlement$K_edu_boy_formal != "yes"] <- "SL"
settlement$K_edu_boy_informal_attendance[settlement$K_edu_boy_informal != "yes"] <- "SL"
settlement$K_edu_girl_formal_attendance[settlement$K_edu_girl_formal != "yes"] <- "SL"
settlement$K_edu_girl_informal_attendance[settlement$K_edu_girl_informal != "yes"] <- "SL"
# CCCM
settlement$L_community_leadership_groups_disabled[settlement$L_community_leadership != "yes"] <- "SL"
settlement$L_community_leadership_groups_women[settlement$L_community_leadership != "yes"] <- "SL"
settlement$L_community_leadership_groups_elderly[settlement$L_community_leadership != "yes"] <- "SL"
settlement$L_community_leadership_groups_youth[settlement$L_community_leadership != "yes"] <- "SL"
settlement$L_community_leadership_groups_none[settlement$L_community_leadership != "yes"] <- "SL"
settlement$L_idp_leadership[settlement$D_D2_idp_now != "yes" | settlement$L_community_leadership != "yes"] <- "SL"
# UXOs
settlement$M_quantity_uxo[settlement$M_mines != "yes"] <- "SL"
settlement$M_mine_acc_numb[settlement$M_mines != "yes"] <- "SL"
# Communications
settlement$N_mobilephone_percent[settlement$N_mobilephone != "yes"] <- "SL"
settlement$N_prevent_info_how[settlement$N_prevent_info != "yes"] <- "SL"
settlement$N_prevent_info_what[settlement$N_prevent_info != "yes"] <- "SL"
settlement[settlement == ""] <- "NC"
ki_coverage <- d.f %>%
dplyr::  select(c(C_info_state, C_info_lga, C_info_ward, C_info_settlement, B_disp_status)) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement")) %>%
summarise(length(B_disp_status))
settlement <- add_column(as.data.frame(settlement), month = rep("Febuary2018", len = nrow(settlement)), .before = 1)
###JOIN TO GIS SETTLEMENT DATA AND THEN MERGE
#COUNT SETTLEMENTS PER-WARD
settlement$ward_lga <- paste0(settlement$C_info_ward,settlement$C_info_lga)
settlement$onesz <- 1
settlements_cnt <-dcast(settlement, ward_lga ~ onesz, value.var = "C_info_settlement", fun.aggregate = length)
colnames(settlements_cnt)[1]<-"ward_lga"
colnames(settlements_cnt)[2]<-"cnt_from_H2R"
settlement$settlement_ward_lga <- paste0(settlement$C_info_settlement,settlement$C_info_ward,settlement$C_info_lga)
#ADD KI COLUMN
ki_coveraged <- d.f %>%
dplyr::  select(c(C_info_state, C_info_lga, C_info_ward, C_info_settlement, B_disp_status)) %>%
group_by_(.dots = c("C_info_state", "C_info_lga", "C_info_ward", "C_info_settlement"))
ki_coveraged$settlement_ward_lga <- paste0(ki_coveraged$C_info_settlement,ki_coveraged$C_info_ward,ki_coveraged$C_info_lga)
unique(ki_coveraged$settlement_ward_lga)
ki_coveraged$onesz<-1
ki_coveraged <-dcast(ki_coveraged, settlement_ward_lga ~ onesz, value.var = "B_disp_status", fun.aggregate = length)
colnames(ki_coveraged)[2]<-"ki_coverage"
settlement <- merge(settlement,ki_coveraged, by="settlement_ward_lga",all.x=TRUE)
#IMPORT GIS SETTLEMENTS
gis_settlements <- read_excel("~/Desktop/Nigeria/Hard_to_reach/GIS_Settlement_list/Wards_X_GRID3_number-settlements.xlsx", sheet = "Feuil1")
#IMPORT GIS SETTLEMENTS
gis_settlements <- read_excel("~/Desktop/Nigeria/Hard_to_reach/GIS_Settlement_list/Wards_X_GRID3_number-settlements.xlsx", sheet = "Feuil1")
settlements_cnt<-merge(settlements_cnt,gis_settlements, by="ward_lga",all.x=TRUE)
settlements_cnt$new_htr_cnt <- as.numeric(settlements_cnt$cnt_from_H2R)
settlements_cnt$new_gis_cnt <- as.numeric(ifelse(is.na(settlements_cnt$Number_of_settlements),0,settlements_cnt$Number_of_settlements))
settlements_cnt$prcnt_of_H2R <- settlements_cnt$new_htr_cnt/settlements_cnt$new_gis_cnt
settlements_cnt[sapply(settlements_cnt, is.infinite)] <- 0
settlements_cnt$prcnt20ov <- ifelse(settlements_cnt$prcnt_of_H2R >=.2,1,0)
settlements_cnt <- subset(settlements_cnt, prcnt20ov ==1, select=c(ward_lga,prcnt20ov))
settlement<- merge(settlement,settlements_cnt,by="ward_lga",all.x=TRUE)
settlement$onesz <- NULL
settlement$ward_lga<-NULL
settlement$settlement_ward_lga <- NULL
settlement$month <- NULL
settlement$prcnt20ov <- ifelse(is.na(settlement$prcnt20ov),0,settlement$prcnt20ov)
settlement<-settlement[moveme(names(settlement), "ki_coverage first")]
write.csv(settlement, AGGREGATED_DATASET, na = "NC", row.names = FALSE)
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE,error=FALSE)
library("cleaninginspectoR")
data<-read.csv(file.choose(),header=TRUE,sep=";")
a<-inspect_all(data,uuid.column.name = "X_uuid")
data<-read.csv(file.choose(),header=TRUE,sep=",")
a<-inspect_all(data,uuid.column.name = "X_uuid")
kable(a)
kable(a[1:1127,])
kable(a[1:1135,])
kable(a[1:1140,])
kable(a[1:1138,])
kable(a[20:1138,])
kable(a[40:1138,])
kable(a[60:1138,])
kable(a[80:1138,])
kable(a[70:1138,])
kable(a[75:1138,])
kable(a[c(75, 80:1138),])
kable(a[c(75,90:1138),])
kable(a[c(75,100:1138),])
kable(a[c(75,110:1138),])
kable(a[c(75,130:1138),])
kable(a[c(75,140:1138),])
kable(a[c(75,147:1138),])
kable(a[c(75,147:149, 170:1138),])
kable(a[c(75,147:149, 190:1138),])
kable(a[c(75,147:149, 200:1138),])
kable(a[c(75,147:149, 220:1138),])
kable(a[c(75,147:149, 210:1138),])
kable(a[c(75,147:149, 215:1138),])
kable(a[c(75,147:149),])
